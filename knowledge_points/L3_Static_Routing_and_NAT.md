# 考点突破：静态路由制表与 NAT 换皮全攻略 🧭

在教授的期末大题里（尤其是类似 2022 Endterm, 2015 Midterm, 2024 等大卷），**“填写静态路由表 (Fill in the Static Routing Table)”** 是一道少则 10 分，多则 15 分的必杀大题。它常常结合了 **ARP 请求、MAC/IP 追踪和 NAT** 一起考。

相比起复杂的动态 RIP 算法，静态路由表不需要复杂的数学运算，它考验的是你的**“全景方向感”和“路由规矩”**。只要你懂下面这三大铁律，这十几分你可以拿到手软。

---

## 核心考点一：填表的绝对格式与三板斧
任何一台路由器的大表，通常只考三个核心列：**`Destination` (目标网段), `Next Hop` (下一跳 IP), `Interface` (出口网卡)**。

在考场上面对一张拓扑图，你只需要按照以下“远近亲疏”的顺序给它填表，绝对不会遗漏：

### 第一斧：直连网段 (Directly Connected Networks)
**只填自己脚底下的地盘**。只要这个网段有一根线直接插在你的这台路由器上：
- **Destination**: 填这个子网的完整网络号 (例如 `10.0.1.0/24` 或者 IPv6 的 `2001:db8:1:d::/64`)。
- **Next Hop**: 永远填 **`0.0.0.0`** (IPv4) 或 **`::`** (IPv6)。因为就在脚边，不需要通过别的中介路由器！
- **Interface**: 填插着这根线的网卡名 (例如 `eth0`, `wlan0`)。

### 第二斧：内部兄弟网段 (Other Internal Subnets)
**填去隔壁楼/隔壁办公室的路**。例如，你要从 R1 路由到旁边的 R2 管辖的子网：
- **Destination**: 填目标子网号 (例如 `10.0.2.0/24`)。
- **Next Hop**: 填**与你相连的那根线上，对方路由器的那个 IP 地址**。(极易错！是填对方与你接壤的那个接口的 IP，绝对不是填目标的 IP！)
- **Interface**: 填你这台机器通往那条线的网卡名 (比如 `wan1`)。

### 第三斧：兜底护城河 (The Default Route / Internet)
题干里如果出现“连接到 Internet (Earth)”，不用想，最后一行必须是它！
- **Destination**: 永远填 **`0.0.0.0/0`** (IPv4) 或 **`::/0`** (IPv6)。这代表“我不认识的 IP 全往这条路上踢”。
- **Next Hop**: 填通往外网的**网关路由器 (Gateway)** 的接壤 IP。
- **Interface**: 填连接网关的那个网卡 (比如 `ppp0`, `eth1`)。

---

## 核心考点二：“尽最大可能聚合” (Summarize Route / Route Aggregation)
原题里往往会有一句原话：*“Summarize individual routes as much as possible / Aggregate as much as possible”*。
**如果不做这一步，填对表也会被扣分！**

**怎么叫聚合？**
假设你要去隔壁的两个部门，一个网段是 `192.168.0.0/24`，另一个是 `192.168.1.0/24`。而且它们**都要经过同一个 Next Hop 从同一个 Interface 出去**。
此时，考官期望你运用你的 Subnetting 切割知识，反向把它们“拼”起来。
- `0` 是 `00000000`
- `1` 是 `00000001`
- 它们的前 23 位是一模一样的！所以这俩网段可以缩写成一行：**`192.168.0.0/23`**。
（这正好呼应上一节 LPM 中掩码缩短以覆盖更大网段的技巧）。

---

## 核心考点三：网络替身使者 NAT (Network Address Translation)
当我们的数据顺着静态路由表终于逃出了私有局域网 (Private Network，比如 `192.168.x.x` 或者 `10.x.x.x`)，准备进入真正的 Internet 时，必须经过守门员：**NAT 路由器**。这是选择题里的高频陷阱！

你必须熟记这套“换源换壳”的机制：
1. **往外发包 (Outgoing Packets)**：内网的 PC1 想发信息给谷歌。当包到达 NAT 边界时，NAT 会把包头里原本是 `192.168.1.5` 的 **Source IP (源 IP)** 和 Source Port 强制替换成自己公网的合法 IP 和一个新分配的端口 (Port Mapping)。
2. **往里收包 (Incoming Packets)**：当谷歌回信时，目标是 NAT 的公网 IP。当包抵达 NAT 路由器时，NAT 会翻开它的小本本 (NAT Translation Table)，查出这个端口原本对应哪个内网机器，然后把包的 **Destination IP (目标 IP)** 和 Dest Port 替换回真正的内网 IP `192.168.1.5` 并扔进去。

> [!WARNING]
> 这也是为什么考试中说“没有 NAT，内网机器就无法上网”。因为私有 IP（比如 `10.x.x.x`）一旦流进真正的 Internet，会被公网路由器直接丢弃（Non-routable）。而且 NAT 天然带来了一层安全保护，因为外网的人是无法主动追踪到原本的内网电脑的。

---

### 📝 考场实战连招口诀
1. 先把**身上直插的线**抄进表里 (Next Hop 写 0.0.0.0)。
2. 把**外网垃圾桶** `0.0.0.0/0` 填进表里，Next hop 写大门 IP。
3. 把**剩下的内部网段**凑一凑，看看去哪里同路，合并网段并填上。
4. NAT 题只要牢记：“出门换源 IP、回家换目标 IP”。

搞定了路由怎么找路，剩下的就是全课件里唯一一个还像“算法题”的硬核算分题：**Link Range (链路状态协议) 里的 Dijkstra 算法找最短路径**。这个算网格的题目虽然不如 RIP 考得多，但一旦出现在选答题里就是白给的数学分。我们要继续破局 Dijkstra 吗？
