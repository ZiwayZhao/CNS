# 考点终极攻坚：从“块跨度”推导“实际IP管辖范围” 🎯

很多同学在算出“跨度/块大小”之后，都会卡在最后一步：**“我算出了跨度是 4，然后呢？它的上下限到底是怎么变出来的？”**

为了帮你在这道必考大题上拿满分，我们必须把这个过程**从零开始、一步一步像切蛋糕一样**拆解一遍。看完这篇，再配上底下的真题演练，你再看任何 IP 网段都会像开了透视眼。

---

## 零基础拆解：为什么 IP 范围是这么算的？

我们以你困惑的 `10.4.32.0 /22` 为例。

### 第一步：找出“战场”在哪里？（抓主心骨）
IP 地址有四个组成部分（四个字节）：`第一节 . 第二节 . 第三节 . 第四节`
掩码的分界线：
- `/8` 管第一节
- `/16` 管第二节
- `/24` 管第三节
- `/32` 管第四节

**`/22` 在 `/16` 到 `/24` 之间**，这说明前面两个部分（`10.4`）已经是铁板钉钉、死死的不能动了。所有的变化（切蛋糕）都发生在**第三节**。
此时，第四节因为是“小弟”，在第三节确定范围时，只需知道：
- **最小就是 0**
- **最大就是 255**（全天下 IP 的最大值）

所以，题目 `10.4.32.0 /22`，我们只需要死盯第三节的这个数字：**`32`**。这叫做**“网段起步数字（基底）”**。

### 第二步：抽出“魔法公式”算跨度
既然我们在第三节（`/24`）搞事情，跨度计算公式就是：
`跨度 = 2 ^ (24 - 掩码)`
对于 `/22` 来说：
`跨度 = 2 ^ (24 - 22) = 2^2 = 4`

**“跨度是 4”意味着什么？**
这意味着以 4 为单位打包。在第三节的这个位置上，网段是**四个数字、四个数字**一波的。
全天下的 `/22` 的网段，第三节的数字只能是：
`0` (0到3)、`4` (4到7)、`8` (8到11)... `32` (32到35)... `36` (36到39)... `128` (128到131)...

### 第三步：推导“管辖范围”（跨度变范围）
你手里的网段名是 `10.4.32.0 / 22`。
- 第一、第二节定死了：必须是 `10.4`
- 第三节的**起步数字**是 `32`。
- 因为**跨度是 4**，所以**下一个网段**的起点将是 `32 + 4 = 36`。

既然下一个人的地盘是从 `36` 开始的，那么你这个地盘的**终点（边界）**就是 `36 - 1 = 35`！

因此，第三部分管的数字就是从 **`32` 一直到 `35`**。
只要一个 IP 的第三部分是 32, 33, 34, 或 35 中的任何一个，它就属于你！

**最后加上第四节组成完整的 IP 范围：**
- **全网段的起点（Network Address）**：第三节用极小值 `32`，第四节用极小值 `0` ➡️ **`10.4.32.0`**
- **全网段的终点（Broadcast Address）**：第三节用极大值 `35`，第四节用极大值 `255` ➡️ **`10.4.35.255`**

这就是为什么 `10.4.32.0 /22` 的实际管辖范围是 `10.4.32.0` 到 `10.4.35.255`。
此时去扫描 `10.4.34.7`：它的第三节是 `34`，完美掉落在 `32~35` 之间，完全命中！

---

## 考场真题演练（Exercise Time 🏋️‍♂️）

光看没用，请拿出草稿纸，挡住答案自己推导一次下面这几道来自历史真题的变种，看看你有没有掌握。

### 练习一：常规操作组 (第三节变化)
**已知路由表有一条规则：`10.1.128.0 /18`。**
**问题：收到了一个目标为 `10.1.180.55` 的数据包，这条规则能匹配（命中）它吗？**

> <details><summary><b>👉 点击查看这题的推理解析与答案</b></summary>
>
> 1. **找战场**：`/18` 落在了第三节 (`/16` ~ `/24`)。前两节 `10.1` 钉死。我们在第三节的起始数字 `128` 身上做文章。
> 2. **算跨度**：公式 `2 ^ (24 - 18) = 2^6 = 64`。所以这个网段是每 64 个数字一组。
> 3. **推范围**：
>    - 起点数字是：`128`
>    - 跨度是 64，下一个网段起步是 `128 + 64 = 192`。
>    - 所以本网段的最大数字界限是 `192 - 1 = 191`。
>    - 整个网段的管辖范围是：**`10.1.128.0` 到 `10.1.191.255`**。
> 4. **核对包裹**：包裹 IP 是 `10.1.180.55`。它的第三节是 `180`。`180` 在 `128` 到 `191` 之间吗？**是的！完全命中！**
> </details>

---

### 练习二：经典雷区组 (第四节变化，最常见的小网段切割)
**已知路由规则：`10.0.3.144 /28`。**
**问题：请推导出这个子网的网络号 (Network)、广播地址 (Broadcast) 以及它覆盖的实际可用 IP 范围？**

> <details><summary><b>👉 点击查看这题的推理解析与答案</b></summary>
>
> 1. **找战场**：`/28` 大于 `/24`。这说明前三节 `10.0.3` 已经全部钉死了，一丝一毫都不能变。我们的战场在第四节，起点数字是 `144`。
> 2. **算跨度**：既然在第四节（32），公式就是 `2 ^ (32 - 28) = 2^4 = 16`。跨度是 16。
> 3. **推范围**：
>    - 起点是：`144`。
>    - 下一个网段起步是：`144 + 16 = 160`。
>    - 本网段的界限是：`160 - 1 = 159`。
> 4. **得出答案**：
>    - **网络号 (Network，不可分配)**：起点那个名字就是它，**`10.0.3.144`**。
>    - **广播地址 (Broadcast，不可分配)**：终点天花板就是它，**`10.0.3.159`**。
>    - **实际管辖范围（实际可用 IP，给电脑配的）**：地板以上、天花板以下，即 **`10.0.3.145` 到 `10.0.3.158`**。
> </details>

---

### 练习三：反向倒推组（LPM 聚合）
**题目：你在公司设置了两个相邻的网段：`10.0.208.0 /24` 和 `10.0.209.0 /24`。现在你想在路由器里写一条路由规则把它们“合并（聚合）”成一条（Aggregate route），这条合并后的路由规则应该怎么写？**

> <details><summary><b>👉 点击查看这题的推理解析与答案</b></summary>
>
> 这道题考的是考点二“聚合”。正向推导会做了，反向就要找跨度：
> 1. 我们要把 `208` 和 `209` 吞并。在第三个字节上，从 `208` 到 `209`，一共包含了 **2 个**网段，这就意味着聚合后的**跨度必须是 2**。
> 2. 既然战场在第三节，根据跨度去倒推掩码：`2 ^ (24 - 掩码) = 2`。显然 `24 - 掩码 = 1`，所以**掩码 = 23**。
> 3. **合并前缀必须用这个块的最底端基准（偶数法则/块对齐原则）**，`208` 起点符合以 2 跨度的要求（208, 210, 212...）。
> 
> > **🔥 核心补充：什么是“偶数法则（块对齐原则）”？为什么不能随便抓两个网段就合？**
> > 在二进制世界里，切分网段**并不是随便找个起点就能切的**，它必须遵守“对齐（Alignment）”物理规律。
> > 既然你算出了**跨度是 $2^n$**，那么这个网段的起点数字，**必须是该跨度大小的整数倍**！
> > - 如果跨度是 **2**，起点必须是 2 的倍数（即偶数）：`0, 2, 4... 208, 210`。
> >   - 👉 `208` 是 2 的倍数，它可以作为起点吞并后一个数字 `209`。✅
> >   - 👉 但如果是 `209` 和 `210`，能变成 `/23` 吗？**绝 对 不 行！** 因为 `209` 不是 2 的倍数，它在二进制里是被“腰斩”的，无法单独成为一个合法块的起步。
> > - 同理，如果我们在之前的题目里算出跨度是 **4**：起点必须是 4 的倍数：`0, 4, 8, 12... 32, 36`。（你看，`32` 刚好是 4 的倍数，所以 `10.4.32.0/22` 是合法的，而 `10.4.33.0/22` 是根本不存在的非法网段名！）
> > - 如果跨度是 **64**：起点只能是 `0, 64, 128, 192`。
> > 
> > **所以：找合并起点时，直接用跨度去“除”一下起步数字。能除尽的那个，才是真大哥（网络底座）！**
> 
> 4. **最终路由条目**：**`10.0.208.0 /23`**。
> *(验证一下：如果按上面的推导法算一遍 `10.0.208.0 /23`，跨度是 `2^(24-23)=2`，管辖范围正是 `208` 到 `209` 的所有设备，完美闭环！)*
> </details>

---

### （加餐）脑筋急转弯：为什么 /30 跨度是 4，但只有 2 台机器能用？
因为在任何跨度计算出来后，每个网段都必须遵守**“缴税规则”**：
- 把最低位的 1 个 IP 交给网络当 **Network Address** (名字)
- 把最高位的 1 个 IP 交给网络当 **Broadcast Address** (大声广播用)

所以对于 `/30`，第一节算出的第四字节跨度是 `2 ^ (32-30) = 4`。
例如一个网段 `10.0.2.0 /30`：
- 范围是从 0 到 3。
- 0 被缴税当做名字（10.0.2.0）。
- 3 被缴税当广播（10.0.2.3）。
- 真正能插上网线给路由器端口配的 IP，**只有 `10.0.2.1` 和 `10.0.2.2`**。整整好好两台，完美适配背对背连接的两台交换机，绝不浪费一个多余的 IP。

这也就是为什么公式里可用主机数永远是**跨度减 2 (`2^x - 2`)**的原因！

---

你可以打开任意一个往年试卷的 Subnetting 或 Forwarding Table 大题，按照上面【找战场 -> 算跨度 -> 起步加跨度推界限】这三步去推一把。只要走通了一次，你一辈子都不会再怕 IP 切割了。如果有哪一题算出来的答案和标准答案对不上，随时发给我一起拆解！
